name: ğŸ“§ Pull Request Notifications

on:
  pull_request:
    types: [opened, closed, synchronize, reopened]
    branches: [master, develop]
  pull_request_review:
    types: [submitted]

env:
  PROJECT_NAME: "Smart Business AI Assistant"

jobs:
  # ğŸ“§ Email Notifications
  notify-email:
    name: ğŸ“§ Send Email Notifications
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ“§ Send PR Opened Email
        if: github.event.action == 'opened'
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "ğŸš€ New Pull Request: ${{ github.event.pull_request.title }}"
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          from: Smart Business AI Assistant <${{ secrets.EMAIL_USERNAME }}>
          html_body: |
            <h2>ğŸš€ New Pull Request Opened</h2>

            <p><strong>Project:</strong> ${{ env.PROJECT_NAME }}</p>
            <p><strong>Title:</strong> ${{ github.event.pull_request.title }}</p>
            <p><strong>Author:</strong> ${{ github.event.pull_request.user.login }}</p>
            <p><strong>Branch:</strong> ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}</p>

            <h3>ğŸ“‹ Description:</h3>
            <div style="background-color: #f6f8fa; padding: 10px; border-radius: 5px;">
              ${{ github.event.pull_request.body }}
            </div>

            <h3>ğŸ“Š Changes:</h3>
            <ul>
              <li>âœ… Files changed: ${{ github.event.pull_request.changed_files }}</li>
              <li>â• Additions: ${{ github.event.pull_request.additions }}</li>
              <li>â– Deletions: ${{ github.event.pull_request.deletions }}</li>
            </ul>

            <p><strong>ğŸ”— <a href="${{ github.event.pull_request.html_url }}">View Pull Request</a></strong></p>

            <hr>
            <p><small>Smart Business AI Assistant - Automated Notification System</small></p>

      - name: ğŸ“§ Send PR Merged Email
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "âœ… Pull Request Merged: ${{ github.event.pull_request.title }}"
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          from: Smart Business AI Assistant <${{ secrets.EMAIL_USERNAME }}>
          html_body: |
            <h2>âœ… Pull Request Merged Successfully</h2>

            <p><strong>Project:</strong> ${{ env.PROJECT_NAME }}</p>
            <p><strong>Title:</strong> ${{ github.event.pull_request.title }}</p>
            <p><strong>Author:</strong> ${{ github.event.pull_request.user.login }}</p>
            <p><strong>Merged by:</strong> ${{ github.event.pull_request.merged_by.login }}</p>
            <p><strong>Branch:</strong> ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}</p>

            <h3>ğŸ“Š Final Stats:</h3>
            <ul>
              <li>ğŸ“ Files changed: ${{ github.event.pull_request.changed_files }}</li>
              <li>â• Lines added: ${{ github.event.pull_request.additions }}</li>
              <li>â– Lines removed: ${{ github.event.pull_request.deletions }}</li>
              <li>ğŸ’¬ Comments: ${{ github.event.pull_request.comments }}</li>
            </ul>

            <p><strong>ğŸ”— <a href="${{ github.event.pull_request.html_url }}">View Merged PR</a></strong></p>

            <hr>
            <p><small>Smart Business AI Assistant - Automated Notification System</small></p>

      - name: ğŸ“§ Send PR Review Email
        if: github.event_name == 'pull_request_review'
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "ğŸ“ PR Review: ${{ github.event.pull_request.title }}"
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          from: Smart Business AI Assistant <${{ secrets.EMAIL_USERNAME }}>
          html_body: |
            <h2>ğŸ“ Pull Request Review Submitted</h2>

            <p><strong>Project:</strong> ${{ env.PROJECT_NAME }}</p>
            <p><strong>PR Title:</strong> ${{ github.event.pull_request.title }}</p>
            <p><strong>Reviewer:</strong> ${{ github.event.review.user.login }}</p>
            <p><strong>Review State:</strong> ${{ github.event.review.state }}</p>

            <h3>ğŸ’¬ Review Comment:</h3>
            <div style="background-color: #f6f8fa; padding: 10px; border-radius: 5px;">
              ${{ github.event.review.body }}
            </div>

            <p><strong>ğŸ”— <a href="${{ github.event.review.html_url }}">View Review</a></strong></p>

            <hr>
            <p><small>Smart Business AI Assistant - Automated Notification System</small></p>

  # ğŸ’¬ Slack Notifications (Alternative)
  notify-slack:
    name: ğŸ’¬ Send Slack Notifications
    runs-on: ubuntu-latest
    if: false # Set to true if you want Slack notifications instead/additionally

    steps:
      - name: ğŸ’¬ Send Slack Message
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: |
            {
              "text": "ğŸš€ New Pull Request in Smart Business AI Assistant",
              "attachments": [
                {
                  "color": "good",
                  "fields": [
                    {
                      "title": "Title",
                      "value": "${{ github.event.pull_request.title }}",
                      "short": false
                    },
                    {
                      "title": "Author",
                      "value": "${{ github.event.pull_request.user.login }}",
                      "short": true
                    },
                    {
                      "title": "Branch",
                      "value": "${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}",
                      "short": true
                    }
                  ],
                  "actions": [
                    {
                      "type": "button",
                      "text": "View PR",
                      "url": "${{ github.event.pull_request.html_url }}"
                    }
                  ]
                }
              ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

  # ğŸ“± Discord Notifications (Alternative)
  notify-discord:
    name: ğŸ“± Send Discord Notifications
    runs-on: ubuntu-latest
    if: false # Set to true if you want Discord notifications instead/additionally

    steps:
      - name: ğŸ“± Send Discord Message
        uses: Ilshidur/action-discord@master
        with:
          args: |
            ğŸš€ **New Pull Request** in Smart Business AI Assistant

            **Title:** ${{ github.event.pull_request.title }}
            **Author:** ${{ github.event.pull_request.user.login }}
            **Branch:** ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}

            **View PR:** ${{ github.event.pull_request.html_url }}
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
